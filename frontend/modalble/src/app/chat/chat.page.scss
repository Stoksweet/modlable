:host {
  --sidebar-w: 280px;
  --chat-w: 420px;     /* right chat panel width when IDE is shown */
  --radius: 16px;
}

.chat-bg {
  --background: transparent;
  background: #f8fafc;
}

/* Base: 3-column (History | Viewer | Chat) */
.layout3 {
  display: grid;
  grid-template-columns: var(--sidebar-w) 1fr var(--chat-w);
  grid-template-rows: 100%;
  height: 100%;
  min-height: 100%;
}

/* START MODE: hide right chat panel, expand viewer */
.layout3.start {
  grid-template-columns: var(--sidebar-w) 1fr 0px;
}

/* LEFT: history */
.sidebar {
  background: white;
  border-right: 1px solid #e2e8f0;
  padding: 12px;
  overflow: auto;
}
.sidebar-header { display: flex; justify-content: space-between; align-items: center; }
.sidebar-search { margin-top: 6px; }
.conv-list { display: grid; gap: 8px; margin-top: 10px; }
.conv-item {
  position: relative;
  text-align: left;
  padding: 10px 36px 10px 10px;
  border-radius: 10px;
  background: #fff;
  border: 1px solid #e2e8f0;
  cursor: pointer;
}
.conv-item.active { outline: 2px solid #6366f1; }
.conv-title { font-weight: 600; font-size: 14px; }
.conv-sub { font-size: 12px; color: #64748b; }
.conv-item .delete { position: absolute; right: 4px; top: 2px; opacity: .8; }

/* MIDDLE: viewer */
.viewerPane {
  display: grid;
  grid-template-rows: auto 1fr;
  min-height: 0;
}
.viewer-toolbar {
  padding: 10px 14px;
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  align-items: center;
}
.repo .name { font-weight: 700; }
.repo .url { font-size: 12px; color: #64748b; text-decoration: none; }
.viewer-controls { display: flex; gap: 8px; align-items: center; }

.viewer { background: #fff; height: 100%; display: grid; }
.viewer.blocked { display: grid; place-items: center; height: 100%; }
.code-frame { width: 100%; height: 100%; border: none; border-top: 1px solid #e5e7eb; }
.frame-note { padding: 14px; color: #475569; font-size: 14px; }

/* RIGHT: chat panel */
.chatPane {
  background: #fff;
  border-left: 1px solid #e2e8f0;
  display: grid;
  grid-template-rows: 1fr auto;
  min-height: 0;
}

/* Shared chat styles (used in start mode and right panel) */
.messages {
  padding: 14px;
  overflow: auto;
  display: grid;
  gap: 10px;
}
.bubble { display: grid; grid-template-columns: 34px 1fr; gap: 10px; }
.avatar { width: 34px; height: 34px; border-radius: 50%; background: #cbd5e1; }
.avatar[data-role="assistant"] { background: #dbeafe; }
.content {
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: var(--radius);
  padding: 10px 12px;
  white-space: pre-wrap;
}
.bubble.me .content { background: #f1f5f9; }

.composer {
  padding: 10px 14px 16px;
  background: #fff;
  border-top: 1px solid #e5e7eb;
}
.composer-form {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 999px;
  padding: 6px 6px 6px 12px;
}
.error { margin-top: 6px; font-size: 12px; color: #ef4444; }

/* START MODE: viewerPane becomes a chat container visually */
.start-chat {
  grid-template-rows: 1fr auto;
}

/* Responsive */
@media (max-width: 1024px) {
  .layout3,
  .layout3.start {
    grid-template-columns: 1fr;      /* stack */
    grid-template-rows: auto auto;   /* viewer on top, chat below (or just chat in start mode) */
  }
  .sidebar { display: none; }
  .chatPane { order: 2; }
  .viewerPane { order: 1; height: 50vh; }
}
